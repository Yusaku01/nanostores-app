# Astro プロジェクトでの状態管理について考える

## 0.目次

- [1.Astro の哲学おさらい](#1-Astroの哲学をおさらい)
- [2.Astro プロジェクトで状態管理をするのか？](#2-Astroプロジェクトで状態管理をするのか)
- [3.状態管理をする方法](#3-状態管理をする方法)
- [4.まとめ](#4-まとめ)

## 1. Astro の哲学おさらい

- そもそも Astro の哲学って何か。

いくつかあると思うけど、公式ドキュメントから抜粋するとまず以下 6 つが特徴的

**Astro の特徴**

- コンテンツコレクション
- アイランド
- デフォルトでゼロ JS
- サーバーファースト
- 自由な UI
- カスタマイズ可能

機能的には、コンテンツコレクションやアイランドが特にハイライトすべきだと思う。後述するが、コンテンツ、すなわち開発者がユーザーに届けたいテキストや画像などのコンテンツをどのように届けるかを考えているフレームワークなのではないだろうか。

そうでないと、デフォルトでゼロ JS などの特徴も持ちえないと思う。JS はものすごく便利なプログラムだが、一時期の SPA ブームによってクライアントで JS を保持・機能させることが流行った結果、その部分を如何に解決するかを考えるフレームワークが乱立している気がする。実際 React 自体も RSC などクライアントで不要に JS を機能させることをやめる方向に動いている気がするし。

さて、ここまで述べたような 6 つの特徴を持ち合わせる Astro というフレームワークだが、Astro が提唱している設計原則は以下 5 つである。

**Astro の設計原則**

- コンテンツ駆動
- サーバーファースト
- デフォルトで高速
- 簡単に使える
- 開発者を重視

特徴と設計原則はどちらが後か先かという話ではあるが、先のコンテンツコレクションやアイランド、ゼロ JS などの特徴にも見られるように、静的を重んじる雰囲気を感じる。これらは元々 Astro が最適なコンテンツ配信を行う上で、不要なものを削ぎ落とした静的ジェネレーターとしての発端にある。

公式ドキュメントにも見られるが、Astro は、React や Next.js などのような Web アプリケーションを作るためというよりも、それらと比較してもより静的に、よりコンテンツを重視したフレームワークというものを目指している。

イメージで言うと、以下の感じだろうか。もちろん一概には言えないし、実際は二者択一でなく、状況にグラデーションがあると思う。Astro で SEO に強い動的アプリが全く実装できないわけではないし、逆に Next.js で静的サイトが実装できないわけでもない。

- 静的〜簡素な動的アプリ
  → Astro
- 簡素な動的アプリ〜複雑アプリ
  → React
- SEO に優れた複雑動的アプリ
  → Next.js

ここでまた公式ドキュメントから言葉を引用すると、Astro は「複雑さへのオプトイン」等ものを体現しているように感じる。

様々なフレームワークとの統合や TS などのロジックも書きやすいが、あくまで必要な場合のオプションであり、デフォルトはゼロ JS で軽量・高速なコンテンツ配信を行うことができる。いわば最初からなんでも詰め合わせのプレゼントボックスにするか、最低限も物しか入ってないが、必要なものを買える引換券を所持している状況 かどうかの違いである。

## 2. Astro プロジェクトで状態管理をするのか

- コーポレートサイトなどの一般的な静的サイトであれば、状態管理は不要だと思う。というか共通管理する状態自体がそこまでない気がする
- ただ、Astro の公式ドキュメントには Nanostores という状態管理ライブラリに関しての説明があるし、状態管理そのものを否定しているわけではない
- 個人的には 0 → 1 で新規制作のプロダクトがあり、そのプロダクトで複雑な状態管理が発生しそうな場合はそもそも Astro 自体を選択しないかも知れない。まぁ状況にはよると思う
- ただし、既存プロダクトの特性や将来的な方向性によっては、Astro を選択する場合もあると思う。なぜならテンプレートエンジンや他フレームワークとのインテグレーションも豊富であるから。表現が正しいかはわからないが、どこかのライブラリやフレームワークに過度にロックインはされてないと思う。強いて言えば Vite やその Vite の内部で機能する ESbuild や Rollup だろうか。ただまぁ言ってもそれくらいな気がする。そういう感じで、静的コンテンツが多い + 状態管理が少しあるくらいの場合は、Astro を選択しなくなることもあると思う。
- そんな時に、Astro プロジェクトで状態管理は果たしてどのように行えるのかを考える必要が出てくる

## 3. Astro プロジェクトで状態管理をする方法

### 手続き的

- global の .ts ファイルを 1 つ作成し、そのファイル内で状態を管理する
- スコープで ts を書く

### JS フレームワークをインテグレーションして、関数的に書く

- React
- Preact

### 状態管理ライブラリを使う

- Nanostores
- Zustand

## 4. まとめ

今回は、〇〇について、説明しました。
本記事の内容を端的にまとめると以下になります。

- 〇〇
- 〇〇
- 〇〇

本記事が皆さんの〇〇の一助となれば幸いです！
最後までお読みいただきありがとうございました！
